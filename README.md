# 小红书内容批量处理程序

这是一个自动化批量处理程序，用于处理根目录下所有子文件夹中的图片和文档内容，生成符合小红书平台风格的内容。

## 功能特性

- 🖼️ **图片处理**: 自动应用滤镜、裁剪底部、添加边框
- 📝 **内容改写**: 使用AI将原始内容改写成小红书风格
- 🏷️ **标题生成**: 基于改写后的内容生成吸引人的标题
- 🔄 **批量处理**: 自动处理所有子文件夹
- ⚡ **错误重试**: 失败时自动重试，最多3次
- 📊 **进度显示**: 实时显示处理进度和状态

## 文件结构要求

```
根目录/
├── 子文件夹1/
│   ├── 图片1.jpg
│   ├── 图片2.jpg
│   └── 正文.docx (或 .txt, .md)
├── 子文件夹2/
│   ├── 图片1.jpg
│   └── 正文.txt
└── ...
```

## 安装依赖

```bash
pip install -r requirements.txt
```

## 配置API密钥

1. `.env` 文件在 `配置与提示词/` 目录

```env
OPENROUTER_API_KEY=your_api_key_here
```

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 配置API密钥和路径

```bash
# 复制环境配置模板
cp 配置与提示词/env_example.txt 配置与提示词/.env

# 编辑 配置与提示词/.env 文件，设置你的配置
```

**必需配置**:
- `OPENROUTER_API_KEY` - OpenRouter API密钥

**可选路径配置**:
- `INPUT_FOLDER_PATH` - 需要遍历改写的文件夹路径 (默认: `.` 当前目录)
- `OUTPUT_FOLDER_PATH` - 改写完成后保存路径 (默认: `新生成文件`)
- `PROCESSED_FOLDER_PATH` - 已处理的文件夹移动路径 (默认: `已处理文件`)

### 3. 准备数据
确保你的根目录下有多个子文件夹，每个子文件夹包含：
- 至少一张图片文件（支持 .jpg, .jpeg, .png, .bmp）
- 一个文档文件（支持 .txt, .docx, .md）

### 4. 运行程序

```bash
python batch_processor.py
```

### 3. 查看结果
程序会在根目录下创建新的文件夹，文件夹名使用生成的标题，包含：
- 处理后的图片文件
- 改写后的正文（保存为 `正文.md`）

## 处理流程

1. **扫描子文件夹**: 自动发现所有子文件夹
2. **图片处理**: 
   - 应用natural滤镜增强效果
   - 裁剪底部19/20部分
   - 添加白色边框
3. **内容改写**: 使用AI将原始内容改写成小红书风格
4. **标题生成**: 基于改写后的内容生成吸引人的标题
5. **输出保存**: 创建新文件夹并保存所有处理结果

## 错误处理

- 每个文件夹最多重试3次
- 如果3次都失败，跳过该文件夹继续处理下一个
- 详细的错误日志和进度提示
- 支持断点续传（重新运行会跳过已处理的文件夹）

## 支持的格式

### 图片格式
- JPG/JPEG
- PNG
- BMP

### 文档格式
- TXT
- DOCX
- MD

## 注意事项

1. 确保有足够的磁盘空间存储处理后的文件
2. API调用需要网络连接
3. 处理大量文件时可能需要较长时间
4. 建议在处理前备份原始文件

## 故障排除

### API连接失败
- 检查 `.env` 文件中的API密钥是否正确
- 确认网络连接正常
- 验证API密钥是否有效

### 图片处理失败
- 检查图片文件是否损坏
- 确认图片格式是否支持
- 检查磁盘空间是否充足

### 文档读取失败
- 检查文档文件编码是否为UTF-8
- 确认文档格式是否支持
- 验证文件权限是否正确

## 项目结构

```
小绿书_副本/
├── batch_processor.py          # 主批量处理程序
├── requirements.txt            # Python依赖包
├── README.md                   # 项目说明文档
├── .cursor/rules/              # Cursor AI规则集
├── 配置与提示词/               # 配置文件统一管理
│   ├── .env                    # 环境配置文件
│   ├── env_example.txt         # 环境配置模板
│   ├── 小红书改写.txt          # 内容改写提示词
│   ├── 小红书咪蒙标题生成.txt  # 标题生成提示词
│   ├── 改图片.py               # 图片处理模块
│   └── openrouter.py           # API集成示例
├── 我的输出文件/               # 处理结果输出目录
└── 我的已处理文件/             # 源文件夹存档目录
```

## 开发信息

- Python版本: 3.7+
- 主要依赖: OpenCV, NumPy, Requests, python-dotenv
- 开发环境: macOS, Windows, Linux

## 许可证

本项目仅供学习和个人使用。
